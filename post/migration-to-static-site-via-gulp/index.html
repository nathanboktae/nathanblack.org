<!DOCTYPE html><html><head><title>Migration to a static site: Experience with Metalsmith vs Gulp - Nathan Black</title><meta charset="utf-8"><meta name="description" content="A blog about modern web development, from front end to Node.js, JavaScript, styling, testing, and software development practices"><meta name="viewport" content="width=device-width"><link rel="icon" type="image/png" href="/favicon.png"><link rel="stylesheet" href="/site.021b7ad.css"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Roboto:300,400|Raleway|Nobile:400,700"></head><body><header><aside><a href="https://github.com/nathanboktae" class="github"></a><a href="https://plus.google.com/+NathanBlackJ" class="gplus"></a><a href="mailto:nathan@nathanblack.org" class="email"></a></aside><div class="logo"><img src="//gravatar.com/avatar/f78c2c988486648311bcf116070e2487.jpg?s=110"></div><h2><a href="/"><span class="name">nathanblack</span><span>.org</span></a></h2><h4>Refining Modern Web Development</h4></header><aside class="github"><h2><a href="https://github.com/nathanboktae"><b>@</b>nathanboktae</a></h2><ul data-bind="foreach: events" class="events"><li data-bind="attr: { class: type }"><span data-bind="text: when" class="date"></span><h3 data-bind="html: summary"></h3><p data-bind="text: $data.details"></p></li></ul></aside><article><span class="date">Sunday, January 29th 2017</span><section class="post"><h1>Migration to a static site: Experience with Metalsmith vs Gulp</h1><div class="content"><p>I <a href="/post/the-beginning">started this site</a> using <a href="http://jsantell.github.io/poet/">poet</a> on top of <a href="http://nodejs.org/">node.js</a> and <a href="http://expressjs.com/">express</a>, mainly wanting to expand my node skills and use my free Azure credits I got as a Microsoft employee. Azure Websites, the Heroku-like PaaS had just launched (now called <a href="https://azure.microsoft.com/en-us/services/app-service/">App Services</a>). It was a nice experience.</p>
<p>Later on while working at <a href="https://www.crunchbase.com/organization/appuri#/entity">Appuri</a>, we decided to move our public website off of Hubspot as it was a nightmare for our talented designer, <a href="https://www.linkedin.com/in/jeffreynoldz">Jeff Reynolds</a>, who knew HTML and CSS, to work in. It would need marketing functionality, but we took the approach that whatever we needed could be provided via a 3rd party JavaScript tag on the client. So we didn&#39;t need a server at all. We could simply serve it from an <a href="http://docs.aws.amazon.com/AmazonS3/latest/dev/WebsiteHosting.html">S3 bucket</a> cheaply and it will always be up. <a href="https://circleci.com">Circle CI</a> would build the site and sync the bucket.</p>
<p>So how to build it? I initially looked at <a href="http://www.metalsmith.io/">Metalsmith</a> that was focused on building these sites, that had all the speciallized packages needed like <a href="https://github.com/segmentio/metalsmith-permalinks">metalsmith-permalinks</a>, <a href="https://www.npmjs.com/package/metalsmith-feed-atom">metalsmith-feed-atom</a>, etc. and YAML front matter as a first class citizen. But I had issues:</p>
<ul>
<li><p>Metalsmith processes all files together, unlike gulp which streams files. A lot of work on static sites requires an aggregate functionality (reorder posts by publish date, count blog entries by tag, build a sitemap, etc.) But you can always go to aggregates from a stream - you can&#39;t stream after you&#39;ve sucked in the whole world. This mainly breaks the <a href="">browser-sync</a> flow where CSS changes could be injected without a page refresh. Instead the whole world runs again. This is a huge dealbeaker and what caused me to switch to gulp.</p>
</li>
<li><p>Gulp has all those plugins for a static site, and more. <a href="https://www.npmjs.com/package/gulp-markdown-to-json">gulp-markdown-to-json</a> for transforming markdown with yaml front-matter, <a href="https://www.npmjs.com/package/gulp-pretty-url">gulp-pretty-url</a> for permalinks (or see below for my 6-liner using <a href="https://www.npmjs.com/package/gulp-rename">gulp-rename</a>), and all the other standard CSS and asset processing packages you would expect. Metalsmith is lacking in this respect (thus <a href="https://www.npmjs.com/package/gulpsmith">gulpsmith</a> exists)</p>
</li>
</ul>
<pre><code class="lang-javascript">const permalink = () =&gt; <span class="hljs-keyword">rename</span>(function(<span class="hljs-keyword">file</span>) {
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">file</span>.extname === <span class="hljs-string">'.html'</span> &amp;&amp; <span class="hljs-keyword">file</span>.<span class="hljs-keyword">basename</span> !== <span class="hljs-string">'index'</span>) {
    <span class="hljs-keyword">file</span>.<span class="hljs-keyword">dirname</span> = path.join(<span class="hljs-keyword">file</span>.<span class="hljs-keyword">dirname</span>, <span class="hljs-keyword">file</span>.<span class="hljs-keyword">basename</span>)
    <span class="hljs-keyword">file</span>.<span class="hljs-keyword">basename</span> = <span class="hljs-string">'index'</span>
  }
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">file</span>
})
</code></pre>
<ul>
<li>No concepts of tasks. Just want to re-optomize those SVGs? Build the whole world again!</li>
</ul>
<p>So I realized that Metalsmith was just a poor gulp implementation, and redid it with gulp packages and some simple custom tasks around other core packages (e.g. used <a href="https://www.npmjs.com/package/feed">feed</a> directly instead of <code>gulp-rss</code>). This method has been working really well at Appuri, so I did it here too, using <a href="https://pages.github.com/">GitHub pages</a>.</p>
</div><ul class="tags"><li><a href="/tag/nodejs">nodejs</a></li><li><a href="/tag/circle-ci">circle-ci</a></li><li><a href="/tag/gulp">gulp</a></li></ul></section></article><script src="/site.021b7ad.js"></script></body></html>